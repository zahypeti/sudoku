environment:
  CODECOV_TOKEN: ENCRYPTED[5c1dcd6bbb7c94516453ebe8c33cc920e57234a17d888e53525cf90fa8cc1c6bc1bdabba9931e856e151f98d5e02194b]

task:
  matrix:
    # Use the default name.
    # GitHub will require pull requests to pass these tests.
    - container:
        matrix:
          image: python:3.8
          image: python:3.7
          image: python:3.6
          image: python:3.5

    - osx_instance:
        matrix:
          image: catalina-base
      container:
        # This has Python 2.7
        image: python:latest

      macos_setup_script:
        # Install Python 3
        - brew install python3
        # Try bootstrapping `pip` from the standard library
        - python3 -m ensurepip --default-pip

    - freebsd_instance:
        matrix:
          image: freebsd-12-0-release-amd64
          image: freebsd-11-2-release-amd64
      container:
        # Use Python 2.7 for now
        image: python:latest

      freebsd_setup_script:
        # Install Python 3 (assume yes when asked for confirmation)
        - pkg install -y python3
        # Try bootstrapping `pip` from the standard library
        - python3 -m ensurepip --default-pip

  install_script:
    # Print Python version for easier debugging
    - python3 --version
    # Upgrade pip, and setuptools
    - python3 -m pip install --upgrade pip setuptools
    # Use `pip install .` instead of `setup.py install`
    - python3 -m pip install .

  flake8_script:
    # Run the PEP8 code style checks
    - python3 -m pip install flake8
    - flake8 --filename=*.py --ignore= --exclude=venv,.eggs .

  test_script:
    # Run tests and compute code coverage
    - python3 -m pip install coverage
    - coverage run setup.py test

  codecov_report_script:
    # Codecov report
    - python3 -m pip install codecov
    - codecov
